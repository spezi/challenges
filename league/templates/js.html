
{% load static %}

<!--   Core JS Files   -->
<script src="{% static 'league/material-kit/assets/js/core/jquery.min.js' %}" type="text/javascript"></script>
<script src="{% static 'league/material-kit/assets/js/core/popper.min.js' %}" type="text/javascript"></script>
<script src="{% static 'league/material-kit/assets/js/core/bootstrap-material-design.min.js' %}" type="text/javascript"></script>
<script src="{% static 'league/material-kit/assets/js/plugins/moment.min.js' %}"></script>
<!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
<script src="{% static 'league/material-kit/assets/js/plugins/bootstrap-datetimepicker.js' %}" type="text/javascript"></script>
<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script src="{% static 'league/material-kit/assets/js/plugins/nouislider.min.js' %}" type="text/javascript"></script>
<!--  Google Maps Plugin  -->
<!--<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>-->
<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
<!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
<script src="{% static 'league/material-kit/assets/js/material-kit.js' %}" type="text/javascript"></script>

<script>
    $( document ).ready(function() {

        function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = cookies[i].trim();
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }

            function csrfSafeMethod(method) {
                // these HTTP methods do not require CSRF protection
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }
            
            var csrftoken = getCookie('csrftoken');

            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });
            
            console.log( "ready!" );

            // leagueview functions

            $('#addplayers').on('click', function initmodal(what) {
                    console.log("add player");
                    $(this).hide();
                    $("#adduserform").show();
                    //$(document).find('.modal-form-body').html('')
                    //addplayerselect();
                    //activate_submit();
                });

            // legview functions

            var players = $('.player')  
            var activeplayer = null
            
            activeplayer = $('.activeplayer')
            active_player_index = $(activeplayer).index();

            // first select
            if(activeplayer.length) {
                console.log(activeplayer.length)
            } else {

                players.on('click', function(){
                    active_player_index = $(this).index();
                    console.log(active_player_index)
                    activeplayer = $(this)
                    activeplayer.addClass("activeplayer");
                    $('.player').unbind();
                });
            }
            

            var set_double = false
            var set_tripple = false

            var init_throw = {
                player: 'none',
                leg: $('#leg_id').val(),
                points: 'none',
                double: false,
                tripple: false,
            }

            $('.btn_double').on('click', function(){
                    set_double = true
                });
            
            $('.btn_tripple').on('click', function(){
                    set_tripple = true
                });
            
            

            $('.numberbtn').on('click', function(){
                this_throw = init_throw;
                
                var count = $(this).data('value');
                this_throw.player = $(".activeplayer").find('.player_id').val();
                this_throw.player_index = 
                this_throw.points = count;
                this_throw.double = set_double;
                this_throw.tripple = set_tripple;
                set_double = false;
                set_tripple = false;
                
                throw_dart(this_throw)
            });


            function throw_dart(this_throw) {
                console.log(this_throw);
                
                var last_player = activeplayer
                
                

                $.ajax({
                        url: "",
                        dataType : 'json',
                        method: "POST",
                        data: JSON.stringify(this_throw),
                        async: false,
                        cache: false,
                        success: function(data) {
                            console.log(data.points)
                            $(activeplayer).find('.points').text(data.points)
                            console.log(data.throwed)
                            $(".thrown").removeClass("thrown");
                            var darts = $(activeplayer).find('.dart')
                            if (data.throwed.first) {
                                $(darts[0]).addClass("thrown");
                            }
                            if (data.throwed.second) {
                                $(darts[0]).addClass("thrown");
                                $(darts[1]).addClass("thrown");
                            }
                            // change active player
                            if(data.throwed.third) {
                                $(darts[0]).addClass("thrown");
                                $(darts[1]).addClass("thrown");
                                $(darts[2]).addClass("thrown");

                                if(active_player_index < players.length-1 ) {
                                    active_player_index++;
                                } else {
                                    active_player_index = 0;
                                }
                                activeplayer = $(players[active_player_index]);
                                $(".activeplayer").removeClass("activeplayer");
                                activeplayer.addClass("activeplayer");
                            }
                            ajax_success = true
                        }
                    }); 
            }
    });
</script> 
